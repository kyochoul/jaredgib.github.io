
<html>
  <head>
   
    <style>
       #chart 
      .c3-circles-trendLine { 
          display: none;   
      }
      .c3-axis .tick line {
        display: none;
      }
      .chart{
          width: 100%;
          min-height: 200px;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/c3@0.7.15/c3.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/c3@0.7.15/c3.min.js"></script>
  </head>
  <body>
    <!-- messageDisplay comes from the thunkable app -->

    <span id="messageDisplay"></span>
    <div id="chart"></div>
    <script>
    var chart = c3.generate({
      bindto: '#chart',
      data: {
        x: 'x',
        columns: [
            ['x'],
            ['Tracked Phenomenon'],
            ['trendLine'],
        ]
    },
    axis: {
        x: {
            type: 'categories',
            tick: {
                centered: true,
                outer: false,
                rotate: -45,
                multiline: false
  
            },
            padding: {
                left: 0,
                right: 0,
            },
            height: 50,
        },
        y: {
            min: 0,
            max: 100,
            padding: 0
        }
    },
      legend: {
      show: false
    },
      tooltip: {
    grouped: false,
    position: (data, width, height, element) => {
      if (data[0].id === 'Tracked Phenomenon'){    // <- change this value to suit your needs
          return { top: 40, left: 0 };
      }
      return { top: -1000, left: 0 };
    }
  }
});
chart.legend.show(['trendLine']);
    // when we get a message from the app, display it on the page
    // message should be a JSON string of a list of numbers
    //I think there is a way to change the legend titles. I dont want the trend title to show at all. EVER
    ThunkableWebviewerExtension.receiveMessage(function(message) {
      try {
        var messageList = JSON.parse(message);
        document.getElementById('messageDisplay').innerHTML = "This chart is for " + messageList.title;
        chart.load({
          columns: [
            ['x'].concat(messageList.x),
            ['Tracked Phenomenon'].concat(messageList.data),
            ['trendLine'].concat(messageList.trend),
          ]
        
        });        
      } catch (e) {
        console.error("An error occurred. Message probably wasn't a JSON string of an array of numbers");
      }
    });
    </script>
  </body>
</html>
